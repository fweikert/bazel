---

tasks:
  macos:
    shards: 1
    shell_commands:
      - ls /Volumes
      - cat /opt/homebrew/bin/buildkite-wrapper.real
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE.bzlmod
      - rm -f WORKSPACE.bzlmod.bak
      - rm -rf $HOME/bazeltest
      - mkdir $HOME/bazeltest
      - ln -sf $OUTPUT_BASE/external $HOME/bazeltest/external
    test_flags:
      - "--config=ci-macos"
      # Fine tune the number of test jobs running in parallel to avoid timeout
      - "--local_test_jobs=2"
    test_targets:
      - "//scripts/docs:rewriter_test"
    include_json_profile:
      - build
      - test
